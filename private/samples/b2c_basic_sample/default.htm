<!DOCTYPE html>
<html> 
    <head><h3>B2C WebApp</h3> 
     <style>
        html {
        display: table;
        margin: auto;
        }

        body {
            display: table-cell;
            vertical-align: middle;
        }
    </style>
        <script src="node_modules/jquery/dist/jquery.min.js"></script>
        <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
        <script>

         $( document ).ready(function() {
            console.log( "ready!" );
            Init();
        });
        
        function Init()
        {
             $.get("b2csettings.json", 
            function(data){
                 $('#tenantSpan').text(data.tenant_name);
                 $.each(data.response_types, function(i, value) {
                 $('#responseTypeSelect').append($('<option>').text(value).attr('value', value));
                 });

                 $("#responseTypeSelect").val("id_token");
                
                 $.each(data.policy, function(i, value) {
                 $('#policyNameSelect').append($('<option>').text(value).attr('value', value));
                 });

                 $.each(data.ui_locales, function(i, value) {
                 $('#langSelect').append($('<option>').text(value).attr('value', value.replace( /(^.*\[|\].*$)/g, '' )));
                 });
                 $('#langSelect').prop("selectedIndex", -1);
                 $("#scope").val("openid");

             });
        }
        function login()
        {            
            var policyName = $('#policyNameSelect').val();
            var ui_locale =  $('#langSelect').val();
            var ui_locale_str = "default lang";
            if(ui_locale != null){
                ui_locale_str = "ui_locales="+ui_locale;
            } 
            $.get("b2csettings.json", 
            function(data){
                //sending policyName as state in request url so that response contains state
                window.location = "https://login.microsoftonline.com/"+data.tenant_name+"/oauth2/v2.0/authorize?p="+ policyName+
                "&scope="+$('#scope').val()+
                "&response_type=" + $('#responseTypeSelect').val()+
                "&redirect_uri=" + data.redirect_uri+
                "&client_id=" + data.client_id+
                "&state="+ policyName +
                "&"+ui_locale_str;
            });     
        }

        function corsTest(){
            $.get("https://localhost:85/signinsignuppage.htm", function(data){
                $('#dump').html(data);
            } );
        }
        </script>
    </head>
 <body>
        <br/>
        <label for="tenantSpan">Tenant Name</label>
        <span id="tenantSpan" class="label label-default"></span>
        <br/>
        <br/>
        <br/>
        <div class="form-group">
            <label for="responseTypeSelect">Response type</label>
            <select class="form-control" id="responseTypeSelect">
                    
            </select>
       </div><br>
        
        <div class="form-group">
            <label for="scope">Scope:</label>
            <input type="text" class="form-control" id="scope">
        </div>
        <br>
        <div class="form-group">
            <label for="policyNameSelect">Policy Name</label>
            <select class="form-control" id="policyNameSelect">
                    
            </select>
       </div><br>
        <div class="form-group">
            <label for="langSelect">Target Language</label>
            <select class="form-control" id="langSelect">
                    
            </select>
       </div><br>
        <br>
        <br>
        <button id="login" class="btn btn-default" style="align-self: center" onclick="login()">Click to SignIn or SignUp</button>
        <button id="testCors" class="btn btn-default" style="display: none" onclick="corsTest()">Test Cors</button>
        <br>
        
       
 </html>